---
phase: 06-calculation-engine
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified: [src/pages/Session.tsx, src/components/Summary.tsx, src/components/TabNavigation.tsx]
autonomous: false
---

<objective>
Add bottom tab navigation and Summary screen showing per-participant totals.

Purpose: Enable users to view everyone's calculated totals with real-time updates.
Output: Tabbed navigation with Items, Tax & Tip, and Summary screens.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-calculation-engine/06-CONTEXT.md
@.planning/phases/06-calculation-engine/06-01-SUMMARY.md

@convex/participants.ts
@src/pages/Session.tsx
@src/components/TaxTipSettings.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TabNavigation component</name>
  <files>src/components/TabNavigation.tsx</files>
  <action>
Create a bottom tab navigation component:

Props:
- activeTab: 'items' | 'taxtip' | 'summary'
- onTabChange: (tab: string) => void
- unclaimedCount?: number (for badge on Items tab)

UI Structure:
- Fixed bottom bar (above iOS safe area)
- Three tabs with icons and labels:
  1. Items (list icon) - shows unclaimed badge if > 0
  2. Tax & Tip (calculator/percent icon)
  3. Summary (users/chart icon)
- Active tab highlighted with blue color
- Inactive tabs in gray

Styling:
- bg-white border-t border-gray-200
- Safe area padding at bottom (pb-safe)
- Equal width tabs with centered content
- Tap targets minimum 44px height

Use simple SVG icons or emoji as placeholders (can refine in Phase 8).
  </action>
  <verify>Component renders without errors: npm run build</verify>
  <done>TabNavigation component with 3 tabs and active state</done>
</task>

<task type="auto">
  <name>Task 2: Create Summary component</name>
  <files>src/components/Summary.tsx</files>
  <action>
Create Summary component showing all participant totals:

Props:
- sessionId: Id<"sessions">
- currentParticipantId: Id<"participants"> | null

Use the participants.getTotals query from Plan 01.

UI Structure:
1. **Unclaimed Warning** (if unclaimedItems.length > 0)
   - Yellow banner: "X items unclaimed ($Y.YY)"
   - Non-blocking, just informational

2. **Participant Cards** (map over totals)
   - Card per participant showing:
     - Name (with "You" indicator if current user, "Host" badge if host)
     - Total: $XX.XX (prominent)
     - Breakdown row: Items $X | Tax $Y | Tip $Z
   - Tap to expand: show itemized list of claimed items
   - Current user's card highlighted with blue border

3. **Group Total** (bottom)
   - Sum of all participant totals
   - Compare with receipt total if available (show match/mismatch)

Styling:
- Cards with rounded corners, subtle shadow
- Expandable sections with chevron indicator
- Blue accent for current user
- Real-time updates as claims change
  </action>
  <verify>Component compiles: npx tsc --noEmit</verify>
  <done>Summary component displays all participant totals with expandable details</done>
</task>

<task type="auto">
  <name>Task 3: Integrate tabs into Session page</name>
  <files>src/pages/Session.tsx</files>
  <action>
Refactor Session.tsx to use tab navigation:

1. Add tab state: `const [activeTab, setActiveTab] = useState<'items' | 'taxtip' | 'summary'>('items')`

2. Restructure page layout:
   - Header (session code, host name) - always visible
   - Share code section - always visible when items exist
   - Participants list - always visible
   - Tab content area (scrollable, takes remaining height)
   - TabNavigation fixed at bottom

3. Tab content:
   - 'items': Current items list, receipt capture, add item button
   - 'taxtip': TaxTipSettings component (from Plan 02)
   - 'summary': Summary component

4. Calculate unclaimedCount from items/claims for badge

5. Ensure scrolling works correctly:
   - Content area scrolls independently
   - Tab bar stays fixed at bottom
   - Safe area handling maintained
  </action>
  <verify>npm run build succeeds</verify>
  <done>Session page has working tab navigation between all three views</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete calculation engine with tab navigation: Items, Tax & Tip, and Summary screens</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Create a new session with some items
    3. Verify Items tab:
       - Claim some items as host
       - See items total at bottom
    4. Switch to Tax & Tip tab:
       - Set tax amount (e.g., $5.00)
       - Set tip to 20% on subtotal
       - Verify preview shows calculated tip
    5. Switch to Summary tab:
       - See your total with breakdown (Items, Tax, Tip)
       - Tap to expand and see claimed items
    6. Open in second browser (join as guest):
       - Claim different items
       - Verify Summary updates in real-time on both devices
       - Verify guest sees Tax & Tip as read-only
    7. Check unclaimed items:
       - Leave an item unclaimed
       - Verify warning appears on Summary
       - Verify unclaimed badge shows on Items tab
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Tab navigation works between all 3 screens
- [ ] Summary shows correct per-participant totals
- [ ] Unclaimed warning displays when items unclaimed
- [ ] Real-time updates work across devices
- [ ] Human verification passed
</verification>

<success_criteria>

- All three tabs functional (Items, Tax & Tip, Summary)
- Summary shows accurate breakdowns per participant
- Real-time updates work as claims change
- Unclaimed items tracked and warned
- Human verified the complete flow
</success_criteria>

<output>
After completion, create `.planning/phases/06-calculation-engine/06-03-SUMMARY.md`
</output>
