---
phase: 15-test-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vitest.config.ts
  - convex/test.setup.ts
  - playwright.config.ts
  - tests/example.test.ts
  - e2e/example.spec.ts
autonomous: true

must_haves:
  truths:
    - "`npm test` runs Vitest and exits successfully"
    - "Convex functions can be tested with mocked database"
    - "Playwright can launch browser and navigate to localhost"
    - "Test scripts are documented in package.json"
  artifacts:
    - path: "vitest.config.ts"
      provides: "Vitest configuration"
    - path: "convex/test.setup.ts"
      provides: "convex-test setup for mocked Convex context"
    - path: "playwright.config.ts"
      provides: "Playwright E2E configuration"
    - path: "tests/example.test.ts"
      provides: "Example unit test proving Vitest works"
    - path: "e2e/example.spec.ts"
      provides: "Example E2E test proving Playwright works"
  key_links:
    - from: "vitest.config.ts"
      to: "tests/**/*.test.ts"
      via: "test pattern matching"
      pattern: "include.*test\\.ts"
    - from: "package.json"
      to: "vitest"
      via: "test script"
      pattern: "\"test\".*vitest"
---

<objective>
Configure test infrastructure for the Split app.

Purpose: Enable backend unit tests (Vitest + convex-test) and browser E2E tests (Playwright) so future phases can add test coverage with confidence.
Output: Working test runners with example tests, all executable via `npm test`.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-test-infrastructure/15-CONTEXT.md

@package.json
@vite.config.ts
@convex/calculations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Vitest with convex-test</name>
  <files>package.json, vitest.config.ts, convex/test.setup.ts, tests/example.test.ts</files>
  <action>
    1. Install dependencies: `npm install -D vitest convex-test`
    2. Create vitest.config.ts:
       - Set environment to "edge-runtime" for Convex compatibility
       - Configure test include pattern: ["tests/**/*.test.ts", "convex/**/*.test.ts"]
       - Set globals: true for describe/it/expect without imports
    3. Create convex/test.setup.ts:
       - Export convexTest helper from convex-test
       - Configure with schema import from ./schema
    4. Create tests/example.test.ts with a simple passing test:
       - Import calculateItemShare from convex/calculations
       - Test: "splits evenly" → calculateItemShare(1000, 2) returns [500, 500]
       - This proves Vitest runs and can import Convex code
    5. Add to package.json scripts:
       - "test": "vitest run"
       - "test:watch": "vitest"
  </action>
  <verify>npm test runs and the example test passes</verify>
  <done>Vitest configured, convex-test setup complete, example test passes</done>
</task>

<task type="auto">
  <name>Task 2: Configure Playwright for E2E tests</name>
  <files>package.json, playwright.config.ts, e2e/example.spec.ts</files>
  <action>
    1. Install Playwright: `npm install -D @playwright/test`
    2. Create playwright.config.ts:
       - Set baseURL to "http://localhost:5173" (Vite dev server)
       - Configure testDir: "./e2e"
       - Set projects: [{ name: "chromium", use: { ...devices["Desktop Chrome"] } }]
       - Configure webServer to run "npm run dev" with reuseExistingServer: true
       - Set timeout to 30000ms (reasonable for dev server startup)
    3. Create e2e/example.spec.ts:
       - Import { test, expect } from "@playwright/test"
       - Test: "homepage loads" → navigate to "/" and expect page to have title containing "Split"
       - This proves Playwright can launch browser and load the app
    4. Add to package.json scripts:
       - "test:e2e": "playwright test"
       - "test:e2e:ui": "playwright test --ui"
    5. Install browsers: `npx playwright install chromium`
  </action>
  <verify>npm run test:e2e runs and the example test passes</verify>
  <done>Playwright configured, example E2E test passes against local dev server</done>
</task>

<task type="auto">
  <name>Task 3: Add unified test command</name>
  <files>package.json</files>
  <action>
    1. Add to package.json scripts:
       - "test:all": "npm run test && npm run test:e2e"
    2. Verify all scripts are documented:
       - "test" - runs unit tests (Vitest)
       - "test:watch" - runs unit tests in watch mode
       - "test:e2e" - runs E2E tests (Playwright)
       - "test:e2e:ui" - runs E2E tests with UI
       - "test:all" - runs both unit and E2E tests
    3. Update README.md with a "Testing" section documenting:
       - `npm test` for unit tests
       - `npm run test:e2e` for E2E tests
       - `npm run test:all` for full test suite
  </action>
  <verify>npm run test:all runs both test suites successfully</verify>
  <done>Unified test command works, README documents testing commands</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm test` runs Vitest and passes
- [ ] `npm run test:e2e` runs Playwright and passes
- [ ] `npm run test:all` runs both successfully
- [ ] No TypeScript errors in test files
- [ ] README documents testing commands
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Test infrastructure ready for phases 16-19 to add actual tests
- Single `npm test` command runs unit tests (per user's vision in CONTEXT.md)
</success_criteria>

<output>
After completion, create `.planning/phases/15-test-infrastructure/15-01-SUMMARY.md`
</output>
