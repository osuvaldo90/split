---
phase: 04-real-time-sync
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [src/components/JoinToast.tsx, src/components/ConnectionStatus.tsx, src/pages/Session.tsx, src/components/Layout.tsx]
autonomous: true
---

<objective>
Add real-time UX feedback: join notifications when participants arrive and reconnection indicator when connection drops.

Purpose: From phase context - "When someone new joins, there's a brief 'Mike joined' notification" and "Show a brief 'Reconnecting...' indicator so people know something happened."
Output: Toast notification system for joins, connection status indicator in layout.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-real-time-sync/04-CONTEXT.md

@src/pages/Session.tsx
@src/components/Layout.tsx
@convex/participants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create join notification toast</name>
  <files>src/components/JoinToast.tsx, src/pages/Session.tsx</files>
  <action>
Create JoinToast component:
- Props: `name: string`, `onDismiss: () => void`
- Displays "Mike joined" with subtle animation (slide in from top or fade)
- Auto-dismisses after 3 seconds
- Positioned fixed at top of screen, below header
- Styling: subtle background (gray-100 or blue-50), small text, rounded

Integrate in Session.tsx:
- Track previous participants list using useRef
- On participants change, compare to find new additions (by _id, not name)
- For each new participant (excluding initial load), show toast
- Only show for participants who joined AFTER page load (use joinedAt timestamp vs component mount time)
- Queue multiple toasts if several join at once (show sequentially with slight delay)

Key: Don't show toasts on initial page load - only for joins that happen while viewing.
Use useEffect with participants dependency, compare to ref to detect additions.
  </action>
  <verify>
1. Open session in one browser
2. Join session from another browser with a name
3. First browser shows "Mike joined" toast that fades after 3 seconds
  </verify>
  <done>Join notifications appear for new participants arriving in real-time</done>
</task>

<task type="auto">
  <name>Task 2: Add connection status indicator</name>
  <files>src/components/ConnectionStatus.tsx, src/components/Layout.tsx</files>
  <action>
Create ConnectionStatus component using Convex's connection state:

```typescript
import { useConvex } from "convex/react";

// Convex client has connectionState() method that returns:
// "connecting" | "connected" | "reconnecting" | "disconnected"
```

Component behavior:
- Only visible when NOT "connected" (hide when everything is fine)
- "connecting" / "reconnecting": Show "Reconnecting..." with subtle spinner
- "disconnected": Show "Connection lost" (more prominent warning)
- Position: Fixed banner at top of screen, full width, small height
- Colors: Yellow/amber for reconnecting, red for disconnected
- Animate in/out smoothly

Add to Layout.tsx:
- Import and render ConnectionStatus at top of layout (above Outlet)
- Should appear above all page content when visible
  </action>
  <verify>
1. Open app normally - no indicator visible
2. Disable network (airplane mode or devtools offline) - see "Connection lost"
3. Re-enable network - see "Reconnecting..." briefly, then indicator disappears
  </verify>
  <done>Connection status visible when network issues occur, hidden when connected</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Join toasts appear for real-time joins (not initial load)
- [ ] Connection indicator appears when offline/reconnecting
- [ ] No visual glitches or layout shifts
</verification>

<success_criteria>

- All tasks completed
- Real-time feedback visible for joins and connection issues
- No TypeScript errors
- UI is subtle and non-intrusive (per phase context: "shouldn't be disruptive")
</success_criteria>

<output>
After completion, create `.planning/phases/04-real-time-sync/04-02-SUMMARY.md`
</output>
