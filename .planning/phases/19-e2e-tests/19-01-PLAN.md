---
phase: 19-e2e-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [e2e/host-flow.spec.ts]
autonomous: true

must_haves:
  truths:
    - "Host can create a bill by entering their name and submitting"
    - "Host can add items with name and price"
    - "Host can set tip percentage in Tax & Tip tab"
    - "Host can view summary tab showing their total"
  artifacts:
    - path: "e2e/host-flow.spec.ts"
      provides: "Host flow E2E tests"
      min_lines: 50
  key_links:
    - from: "test"
      to: "Home page â†’ Session page"
      via: "Create bill flow"
      pattern: "page\\.goto.*page\\.fill.*page\\.click"
---

<objective>
Create E2E tests for the complete host flow: create bill, add items, set tip, view summary.

Purpose: Validate that hosts can complete the primary user journey from start to finish.
Output: `e2e/host-flow.spec.ts` with tests covering E2E-01 through E2E-04.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-test-infrastructure/15-01-SUMMARY.md

@playwright.config.ts
@e2e/example.spec.ts
@src/pages/Home.tsx
@src/pages/Session.tsx
@src/components/TaxTipSettings.tsx
@src/components/Summary.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create host flow test file with create bill test</name>
  <files>e2e/host-flow.spec.ts</files>
  <action>
Create `e2e/host-flow.spec.ts` with Playwright tests for the host flow.

**Test structure:**
```typescript
import { test, expect } from '@playwright/test';

test.describe('Host Flow', () => {
  test('E2E-01: can create bill and enter display name', async ({ page }) => {
    // 1. Navigate to home
    await page.goto('/');

    // 2. Enter name in "Your name" input
    await page.fill('input#name', 'Alice');

    // 3. Click "Start Bill" button (no code entered = create mode)
    await page.click('button:has-text("Start Bill")');

    // 4. Wait for navigation to /bill/:code
    await expect(page).toHaveURL(/\/bill\/[A-Z0-9]{6}/);

    // 5. Verify session code is displayed in header
    await expect(page.locator('text=/[A-Z0-9]{6}/')).toBeVisible();
  });
});
```

**Key patterns to follow:**
- Use semantic selectors (input#name, button:has-text) over CSS classes
- Use `expect(page).toHaveURL()` for navigation verification
- Use `await expect(...).toBeVisible()` for element presence
- No `waitForTimeout()` - use Playwright's auto-waiting
  </action>
  <verify>npx playwright test e2e/host-flow.spec.ts --grep "E2E-01" passes</verify>
  <done>Create bill test passes, navigates to session page</done>
</task>

<task type="auto">
  <name>Task 2: Add item creation and tip configuration tests</name>
  <files>e2e/host-flow.spec.ts</files>
  <action>
Add tests for E2E-02, E2E-03, and E2E-04 to the host flow spec.

**E2E-02: Host can add items with name and price**
```typescript
test('E2E-02: can add items with name and price', async ({ page }) => {
  // 1. Create a bill first (reuse pattern from E2E-01)
  await page.goto('/');
  await page.fill('input#name', 'Alice');
  await page.click('button:has-text("Start Bill")');
  await expect(page).toHaveURL(/\/bill\/[A-Z0-9]{6}/);

  // 2. Click "+ Add Item" button
  await page.click('button:has-text("+ Add Item")');

  // 3. Fill item name in the draft item form
  await page.fill('input[placeholder="Item name"]', 'Burger');

  // 4. Fill price (input after $ sign)
  await page.fill('input[inputmode="decimal"]', '12.99');

  // 5. Click Save
  await page.click('button:has-text("Save")');

  // 6. Verify item appears in list
  await expect(page.locator('text=Burger')).toBeVisible();
  await expect(page.locator('text=$12.99')).toBeVisible();
});
```

**E2E-03: Host can set tip settings**
```typescript
test('E2E-03: can set tip settings', async ({ page }) => {
  // Create bill and add an item first
  await page.goto('/');
  await page.fill('input#name', 'Alice');
  await page.click('button:has-text("Start Bill")');
  await expect(page).toHaveURL(/\/bill\/[A-Z0-9]{6}/);

  // Add an item so we have a subtotal
  await page.click('button:has-text("+ Add Item")');
  await page.fill('input[placeholder="Item name"]', 'Fries');
  await page.fill('input[inputmode="decimal"]', '5.00');
  await page.click('button:has-text("Save")');

  // Navigate to Tax & Tip tab
  await page.click('button:has-text("Tax & Tip")');

  // Set tip percentage (look for tip input in TaxTipSettings)
  // The tip input should be visible on the Tax & Tip tab
  const tipInput = page.locator('input[id*="tip"]').or(page.locator('input').filter({ hasText: /tip/i }));
  await tipInput.first().fill('20');

  // Verify tip is applied (UI should show updated tip)
  // Note: Exact verification depends on TaxTipSettings UI
  await expect(page.getByText('20%')).toBeVisible();
});
```

**E2E-04: Host can view summary with totals**
```typescript
test('E2E-04: can view summary with totals', async ({ page }) => {
  // Create bill, add item, claim it
  await page.goto('/');
  await page.fill('input#name', 'Alice');
  await page.click('button:has-text("Start Bill")');
  await expect(page).toHaveURL(/\/bill\/[A-Z0-9]{6}/);

  // Add an item
  await page.click('button:has-text("+ Add Item")');
  await page.fill('input[placeholder="Item name"]', 'Salad');
  await page.fill('input[inputmode="decimal"]', '10.00');
  await page.click('button:has-text("Save")');

  // Claim the item (click on it to toggle claim)
  await page.click('text=Salad');

  // Navigate to Summary tab
  await page.click('button:has-text("Summary")');

  // Verify participant card shows with total
  await expect(page.locator('text=Alice')).toBeVisible();
  await expect(page.locator('text=/\\$10\\.00/')).toBeVisible();
});
```

**Important patterns:**
- Each test is self-contained (creates its own bill)
- Use `.or()` for resilient selectors when exact selector unknown
- Claim items by clicking on them (ClaimableItem component)
- Tab navigation uses button:has-text patterns
  </action>
  <verify>npx playwright test e2e/host-flow.spec.ts passes (all 4 tests)</verify>
  <done>All host flow tests pass: create, add items, set tip, view summary</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx playwright test e2e/host-flow.spec.ts` passes all 4 tests
- [ ] Tests run without flakiness (no random failures)
- [ ] Tests use auto-waiting, no `waitForTimeout()`
- [ ] Each test is isolated (creates its own session)
</verification>

<success_criteria>
- All tasks completed
- E2E-01, E2E-02, E2E-03, E2E-04 requirements satisfied
- Host flow tests pass reliably
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/19-e2e-tests/19-01-SUMMARY.md`
</output>
