---
phase: 03.1-inline-item-editing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Session.tsx
  - src/components/InlineItem.tsx
autonomous: true
---

<objective>
Remove the confirm step from receipt processing and enable inline item editing for all participants.

Purpose: After OCR, items should appear directly in the session view where anyone can edit them. This removes the host bottleneck and enables true collaborative editing.
Output: Session page with inline-editable items, "Add Item" button for all users, no confirm step after receipt scan.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/03-session-management/03-03-SUMMARY.md

@src/pages/Session.tsx
@src/components/ItemEditor.tsx
@convex/items.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Skip confirm step - save items directly after OCR</name>
  <files>src/pages/Session.tsx</files>
  <action>
Modify the receipt processing flow in Session.tsx:
1. Remove the "reviewing" state from ReceiptState type (delete that variant)
2. In handleReceiptUpload, after successful parseReceipt:
   - Convert items to cents (price * 100)
   - Call addBulk mutation directly
   - Call updateTotals mutation if subtotal/tax present
   - Reset to "idle" state
3. Remove the ReceiptReview component import and its JSX rendering
4. Remove handleReviewConfirm and handleReviewCancel functions
5. Keep error handling and retry logic

The ReceiptReview.tsx component will be DELETED in a later task (or can stay orphaned).
The flow becomes: capture → processing → idle (items now in DB and visible via real-time query)
  </action>
  <verify>
1. npm run build succeeds
2. Receipt capture → OCR → items appear immediately in "Items" section without confirm step
  </verify>
  <done>Receipt processing saves items directly to DB without manual confirm step</done>
</task>

<task type="auto">
  <name>Task 2: Create InlineItem component with edit mode</name>
  <files>src/components/InlineItem.tsx</files>
  <action>
Create a new InlineItem component that can toggle between view and edit modes:

**Props:**
- item: { _id: Id&lt;"items"&gt;, name: string, price: number, quantity: number }
- (no callback props - use mutations directly)

**View mode (default):**
- Display item name, price ($X.XX), quantity if > 1
- Show an edit button (pencil icon) on the right
- Clicking edit button switches to edit mode

**Edit mode:**
- Reuse ItemEditor component's field structure (name input, price input with $, quantity if > 1)
- Add "Save" and "Cancel" buttons
- On Save: call api.items.update mutation with itemId and changed fields (convert price to cents)
- On Cancel: discard local changes, return to view mode
- Add delete button (trash icon) that calls api.items.remove mutation

**Styling:**
- Match existing ItemEditor styling (bg-gray-50 rounded-lg, p-3)
- Edit button: min-h-[44px] for tap target
- Use inline editing pattern (no modal)
  </action>
  <verify>
1. npm run build succeeds
2. Component renders in view mode with edit button
3. Edit mode shows editable fields
  </verify>
  <done>InlineItem component toggles between view and edit mode with Convex mutations</done>
</task>

<task type="auto">
  <name>Task 3: Integrate InlineItem and Add Item button in Session page</name>
  <files>src/pages/Session.tsx</files>
  <action>
Replace the static item list with InlineItem components and add "Add Item" button:

1. Import InlineItem component
2. In the "Items" section, replace the static item display with:
   - Map over items using InlineItem component (pass full item object with _id)
3. Add "Add Item" button below the items list:
   - Same style as ReceiptReview's add button (border-dashed, gray-300)
   - On click: call api.items.add mutation with sessionId, empty name "", price 0, quantity 1
   - The new item will appear via real-time query and can be edited inline

4. Remove ReceiptReview import if not already done
5. The items section should work for ALL participants (no host-only restrictions)

**Note:** Keep the existing Items Total calculation at the bottom of items section.
  </action>
  <verify>
1. npm run build succeeds
2. Items display with edit buttons
3. Clicking edit on an item shows editable fields
4. "Add Item" button creates a new editable item row
5. Changes persist immediately via Convex real-time sync
  </verify>
  <done>Session page shows inline-editable items with Add Item button available to all</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] Receipt OCR flow skips confirm step, items appear immediately
- [ ] Any user can edit existing items inline
- [ ] Any user can add new items
- [ ] Any user can delete items
- [ ] Changes sync in real-time (test with two browser tabs)
</verification>

<success_criteria>
- All tasks completed
- No TypeScript errors
- Receipt processing no longer has confirm step
- Items are editable inline by any participant
- "Add Item" button works for all participants
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-inline-item-editing/03.1-01-SUMMARY.md`
</output>
