---
phase: 03-session-management
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [src/pages/Join.tsx, src/pages/Session.tsx, convex/participants.ts]
autonomous: true
---

<objective>
Implement join session flow and participant list display.

Purpose: Allow friends to join a session by code and see who's in the session.
Output: Working join flow with name validation and real-time participant list.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-session-management/03-CONTEXT.md

@src/pages/Join.tsx
@src/pages/Session.tsx
@convex/participants.ts
@convex/sessions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add unique name validation to participants.join</name>
  <files>convex/participants.ts</files>
  <action>
Modify the participants.join mutation to prevent duplicate names:

1. Before inserting, query existing participants in the session
2. Check if any participant has the same name (case-insensitive comparison, trimmed)
3. If duplicate found, throw an error with clear message: "Name already taken in this session"
4. Keep existing functionality otherwise

This prevents confusion when multiple people have the same display name.
  </action>
  <verify>npx convex dev logs show no errors, test by joining with duplicate name (should error)</verify>
  <done>participants.join mutation rejects duplicate names within same session</done>
</task>

<task type="auto">
  <name>Task 2: Build Join page with code and name entry</name>
  <files>src/pages/Join.tsx</files>
  <action>
Replace placeholder Join page with functional join flow:

1. State: code, name, isLoading, error
2. Use useQuery for sessions.getByCode (skip if code empty/too short)
3. UI layout:
   - "Join a session" heading
   - Code input: 6 chars max, auto-uppercase, clear placeholder "Enter code"
   - Show "Session found" or "No session with this code" feedback
   - Name input: appears when valid session found, placeholder "Your name"
   - Join button: disabled until valid session and name entered
   - Error display for duplicate name or other errors
4. On Join click:
   - Call participants.join mutation
   - On success: navigate to /session/:code
   - On error: display error message (e.g., "Name already taken")
5. Use useMutation for participants.join
6. Use useNavigate from react-router-dom

Styling: Mobile-first, stacked inputs, large buttons, clear feedback states.
Consider: Auto-focus code input on mount.
  </action>
  <verify>npm run dev, go to /join, enter valid code, enter name, join, verify redirect to session</verify>
  <done>Join page validates code, accepts name, joins session, navigates to Session page</done>
</task>

<task type="auto">
  <name>Task 3: Add participant list to Session page</name>
  <files>src/pages/Session.tsx</files>
  <action>
Add participant list display to Session page:

1. Use useQuery with api.participants.listBySession to fetch participants
2. Create a "Who's here" section:
   - Heading: "Who's here (N)" where N is participant count
   - List participant names, sorted by joinedAt
   - Host indicator (optional): small badge or "(host)" text next to host's name
3. Position: After share code section, before items list
4. Real-time: Will auto-update when new participants join (Convex magic)

Styling: Simple name list, clear text, mobile-friendly spacing.
  </action>
  <verify>npm run dev, create session, have second browser/tab join, verify participant list updates in real-time</verify>
  <done>Session page shows real-time participant list</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Join page accepts code and name
- [ ] Duplicate name is rejected with clear error
- [ ] Successful join navigates to session
- [ ] Session page shows participant list
- [ ] Participant list updates in real-time when someone joins
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Full join flow works end-to-end
- Participant list is real-time
</success_criteria>

<output>
After completion, create `.planning/phases/03-session-management/03-03-SUMMARY.md`
</output>
