---
phase: 10.1-bug-fixes-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [src/pages/Home.tsx, src/pages/Join.tsx, src/App.tsx]
autonomous: true
---

<objective>
Combine join bill flow into the home page for one-screen simplicity.

Purpose: Reduce navigation steps for joining participants by exposing both "Start a Bill" and "Join a Bill" on a single screen. The separate Join page becomes redundant.
Output: Home page with expandable join section, removed /join route.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10.1-bug-fixes-ux/10.1-CONTEXT.md

@src/pages/Home.tsx
@src/pages/Join.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add expandable join section to Home page</name>
  <files>src/pages/Home.tsx</files>
  <action>
Add a "Join a Bill" section to Home.tsx that expands to show the code input:

1. Add state for join mode:
```typescript
const [showJoinSection, setShowJoinSection] = useState(false);
const [joinCode, setJoinCode] = useState("");
const [joinName, setJoinName] = useState("");
const [joinError, setJoinError] = useState<string | null>(null);
const [isJoining, setIsJoining] = useState(false);
```

2. Add query for session lookup (skip when code too short):
```typescript
const joinSession = useQuery(
  api.sessions.getByCode,
  joinCode.length >= 6 ? { code: joinCode } : "skip"
);
```

3. Add mutation for joining:
```typescript
const joinSessionMutation = useMutation(api.participants.join);
```

4. Port the auto-rejoin logic from Join.tsx:
- Check localStorage for stored participant when session found
- Query participant to verify it exists
- Auto-redirect if valid stored participant

5. Add UI section BEFORE the "Recent Bills" section:
```tsx
{/* Join Bill section */}
<div className="mt-6">
  {!showJoinSection ? (
    <button
      onClick={() => setShowJoinSection(true)}
      className="w-full py-3 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
    >
      Join a Bill
    </button>
  ) : (
    <div className="space-y-3 p-4 bg-gray-50 rounded-lg">
      <div className="flex justify-between items-center">
        <h3 className="font-medium text-gray-900">Join a Bill</h3>
        <button
          onClick={() => {
            setShowJoinSection(false);
            setJoinCode("");
            setJoinName("");
            setJoinError(null);
          }}
          className="text-gray-400 hover:text-gray-600"
        >
          âœ•
        </button>
      </div>
      {/* Code input */}
      <input
        type="text"
        value={joinCode}
        onChange={(e) => {
          setJoinCode(e.target.value.toUpperCase().slice(0, 6));
          setJoinError(null);
        }}
        placeholder="Enter 6-digit code"
        maxLength={6}
        className="w-full px-4 py-3 text-lg font-mono tracking-widest text-center border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 uppercase"
        autoComplete="off"
      />
      {/* Status message */}
      {/* Name input (when session found) */}
      {/* Join button */}
      {/* Error display */}
    </div>
  )}
</div>
```

6. Add the join handler (port from Join.tsx handleJoin):
```typescript
async function handleJoin() {
  if (!joinSession || !joinName.trim()) return;
  setIsJoining(true);
  setJoinError(null);
  try {
    const participantId = await joinSessionMutation({
      sessionId: joinSession._id,
      name: joinName.trim(),
    });
    storeParticipant(joinSession.code, participantId);
    addBillToHistory({
      code: joinSession.code,
      participantName: joinName.trim(),
      participantId,
    });
    navigate(`/bill/${joinSession.code}`);
  } catch (err) {
    let errorMessage = "Failed to join bill";
    if (err instanceof Error) {
      const match = err.message.match(/Uncaught Error:\s*(.+)$/);
      errorMessage = match ? match[1] : err.message;
    }
    setJoinError(errorMessage);
    setIsJoining(false);
  }
}
```

7. Import required utilities:
```typescript
import { getStoredParticipant, storeParticipant, clearParticipant } from "../lib/sessionStorage";
```

Note: The stored participant verification logic requires querying participants.getById - use same pattern as Join.tsx with useEffect to check and auto-redirect.
  </action>
  <verify>npm run build succeeds, home page shows expandable join section</verify>
  <done>Home page has "Join a Bill" button that expands to show code input, name input (when session found), and join button. Auto-rejoin works via localStorage check.</done>
</task>

<task type="auto">
  <name>Task 2: Remove Join page and route</name>
  <files>src/App.tsx, src/pages/Join.tsx</files>
  <action>
1. Remove the /join route from App.tsx:
```typescript
// Remove this line:
<Route path="join" element={<Join />} />
// And the import:
import Join from "./pages/Join";
```

2. Delete src/pages/Join.tsx entirely (all functionality now in Home.tsx).

3. Search codebase for any links to /join and update them (there should be none based on current code, but verify).
  </action>
  <verify>npm run build succeeds, /join route returns 404, home page join flow works end-to-end</verify>
  <done>Join.tsx deleted, /join route removed, all join functionality available on home page.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Home page shows "Join a Bill" button
- [ ] Clicking "Join a Bill" expands to show code input
- [ ] Entering valid 6-digit code shows session status
- [ ] Name input appears when session found
- [ ] Join button creates participant and redirects to /bill/:code
- [ ] /join route no longer exists
</verification>

<success_criteria>

- Home page has expandable "Join a Bill" section
- Join flow works entirely from home page
- /join route removed
- Auto-rejoin from localStorage works
- Recent Bills section still displays correctly
</success_criteria>

<output>
After completion, create `.planning/phases/10.1-bug-fixes-ux/10.1-02-SUMMARY.md`
</output>
