---
phase: 14-access-control
plan: 03
type: execute
wave: 2
depends_on: ["14-02"]
files_modified:
  - src/pages/Session.tsx
  - src/components/ClaimableItem.tsx
  - src/components/TaxTipSettings.tsx
autonomous: true

must_haves:
  truths:
    - "Frontend passes participantId to all mutations"
    - "No TypeScript errors from updated Convex API signatures"
    - "Claiming items still works for joined participants"
  artifacts:
    - path: "src/pages/Session.tsx"
      provides: "Updated mutation calls with participantId"
      contains: "participantId:"
    - path: "src/components/ClaimableItem.tsx"
      provides: "Updated claim calls with participantId"
      contains: "participantId"
  key_links:
    - from: "frontend components"
      to: "Convex mutations"
      via: "participantId prop/context"
      pattern: "participantId.*currentParticipantId"
---

<objective>
Update frontend mutation calls to pass the required participantId parameter.

Purpose: After Plan 02 adds participantId requirements to mutations, the frontend must pass this parameter. This plan updates all mutation call sites to include participantId.

Output: All frontend mutation calls include participantId, TypeScript compiles, functionality works.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan that modified backend
@.planning/phases/14-access-control/14-02-PLAN.md

# Frontend files that call mutations
@src/pages/Session.tsx
@src/components/ClaimableItem.tsx
@src/components/TaxTipSettings.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Session.tsx mutation calls</name>
  <files>src/pages/Session.tsx</files>
  <action>
Update mutation calls in Session.tsx to pass participantId:

**addItem call (around line 242-243):**
Current: `await addItem({ sessionId: session._id, name, price, quantity });`
Updated: `await addItem({ sessionId: session._id, name, price, quantity, participantId: currentParticipantId! });`

**updateTotals call (around line 165-169):**
Current: `await updateTotals({ sessionId: session._id, subtotal: ..., tax: ... });`
Updated: `await updateTotals({ sessionId: session._id, subtotal: ..., tax: ..., participantId: currentParticipantId! });`

Note: The `!` non-null assertion is safe because these mutations are only callable when the user is a participant (JoinGate prevents non-participants from seeing these controls after Plan 01).

Make sure all paths through handleReceiptUpload that call updateTotals include participantId.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>Session.tsx passes participantId to addItem and updateTotals</done>
</task>

<task type="auto">
  <name>Task 2: Update ClaimableItem mutation calls</name>
  <files>src/components/ClaimableItem.tsx</files>
  <action>
First read the ClaimableItem component to understand how it calls mutations.

The component calls:
- claims.claim - needs to pass participantId in correct field
- items.update - needs to add participantId parameter

Update all mutation calls to include participantId. The component already receives `currentParticipantId` as a prop.

For items.update calls: add `participantId: currentParticipantId!`

For claims.claim: verify the participantId is being passed correctly (it may already be passed but named differently).

Search the file for all useMutation and their call sites.
  </action>
  <verify>npm run build succeeds, ClaimableItem passes participantId</verify>
  <done>ClaimableItem passes participantId to all mutations</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without TypeScript errors
- [ ] Session.tsx addItem calls include participantId
- [ ] Session.tsx updateTotals calls include participantId
- [ ] ClaimableItem mutation calls include participantId
- [ ] Manually test: join a session, claim an item - should work
- [ ] Manually test: add an item - should work
</verification>

<success_criteria>

- All frontend mutation calls pass participantId
- TypeScript compiles without errors
- Item claiming works for joined participants
- Adding items works for joined participants
- Receipt upload and total update works
</success_criteria>

<output>
After completion, create `.planning/phases/14-access-control/14-03-SUMMARY.md`
</output>
