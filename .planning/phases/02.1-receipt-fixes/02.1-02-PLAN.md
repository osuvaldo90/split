---
phase: 02.1-receipt-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [convex/actions/parseReceipt.ts]
autonomous: true
---

<objective>
Update OCR to split quantity items into separate line items for bill splitting.

Purpose: Enable individual item claiming when receipts show "2 Pilsner $13" - should become 2 separate $6.50 items.
Output: OCR returns split items ready for individual claiming.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@convex/actions/parseReceipt.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update OCR prompt to split quantity items</name>
  <files>convex/actions/parseReceipt.ts</files>
  <action>
Update the RECEIPT_PROMPT constant to instruct Claude to split quantity items into separate lines:

Add these rules to the prompt:
```
- IMPORTANT: If an item has quantity > 1, split it into separate items with quantity: 1 each
  - Example: "2 Pilsner $13" becomes TWO items: [{"name": "Pilsner", "price": 6.50, "quantity": 1}, {"name": "Pilsner", "price": 6.50, "quantity": 1}]
  - Divide the total price evenly among the split items
  - For odd divisions, add the extra cent to the first item (e.g., $10 รท 3 = $3.34, $3.33, $3.33)
- Common quantity patterns to detect and split:
  - Leading number: "2 Beer", "3x Tacos"
  - Trailing: "Beer (2)", "Tacos x3"
  - Multiplication notation: "2 @ $5.00"
```

Also update the JSON format example to show quantity: 1 for all items since we're splitting.

The key insight: this app is for bill splitting, so "2 Pilsner" needs to be 2 claimable items, not 1 item with quantity 2.
  </action>
  <verify>
The prompt change is text-only, no runtime verification possible without an actual receipt image.
Manual verification: Review the updated prompt text for correctness.
  </verify>
  <done>OCR prompt updated to split quantity items into individual line items</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] RECEIPT_PROMPT includes quantity splitting instructions
- [ ] Example in prompt shows split items with quantity: 1
</verification>

<success_criteria>

- Task completed
- Prompt clearly instructs splitting behavior
- Rounding strategy documented (extra cent to first item)
  </success_criteria>

<output>
After completion, create `.planning/phases/02.1-receipt-fixes/02.1-02-SUMMARY.md`
</output>
