---
phase: 02.1-receipt-fixes
plan: 02
subsystem: api
tags: [claude, ocr, receipt-parsing, bill-splitting]

# Dependency graph
requires:
  - phase: 02-receipt-processing
    provides: Receipt parsing infrastructure and RECEIPT_PROMPT
provides:
  - Quantity-aware item splitting in OCR results
  - Individual claimable items from multi-quantity line items
affects: [03-item-claiming, 06-calculation-engine]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Prompt engineering for domain-specific behavior
    - Even price division with rounding strategy

key-files:
  created: []
  modified:
    - convex/actions/parseReceipt.ts

key-decisions:
  - "Extra cent goes to first item for odd divisions (e.g., $10/3 = $3.34, $3.33, $3.33)"

patterns-established:
  - "Quantity splitting: all items return quantity: 1 for bill splitting"

issues-created: []

# Metrics
duration: 1min
completed: 2026-01-14
---

# Phase 02.1 Plan 02: Split Quantity Items Summary

**OCR prompt updated to split multi-quantity items into individual claimable line items for bill splitting**

## Performance

- **Duration:** 1 min
- **Started:** 2026-01-14T20:14:22Z
- **Completed:** 2026-01-14T20:14:58Z
- **Tasks:** 1
- **Files modified:** 1

## Accomplishments

- Updated RECEIPT_PROMPT to split quantity items into separate entries
- Added rounding strategy for odd divisions (extra cent to first item)
- Documented common quantity patterns to detect (leading number, trailing, multiplication notation)
- Updated example in prompt to show split items with quantity: 1

## Task Commits

Each task was committed atomically:

1. **Task 1: Update OCR prompt to split quantity items** - `85f6e0f` (feat)

## Files Created/Modified

- `convex/actions/parseReceipt.ts` - Updated RECEIPT_PROMPT with quantity splitting rules

## Decisions Made

- Extra cent goes to first item for odd divisions (e.g., $10/3 = $3.34, $3.33, $3.33)
- All output items must have quantity: 1 (enforced in prompt)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## Next Phase Readiness

- OCR now returns split items ready for individual claiming
- Ready for Plan 03 (format money inputs consistently)

---
*Phase: 02.1-receipt-fixes*
*Completed: 2026-01-14*
