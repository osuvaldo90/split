---
phase: 05-item-management
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified: [src/components/ClaimableItem.tsx, convex/claims.ts]
autonomous: true
---

<objective>
Add visual claim indicators and host unclaim capability.

Purpose: Make it instantly clear which items I've claimed and which are unclaimed. Give host power to fix mistakes.
Output: Visual distinction for my claims, unclaimed indicators, host can remove anyone's claim.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-item-management/05-CONTEXT.md
@.planning/phases/05-item-management/05-01-SUMMARY.md

@src/components/ClaimableItem.tsx
@convex/claims.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add visual distinction for claimed vs unclaimed items</name>
  <files>src/components/ClaimableItem.tsx</files>
  <action>
    Enhance ClaimableItem visuals:

    1. **My claims stand out:**
       - If currentParticipantId is in the claimers list, add a visual indicator:
       - Option A: Left border accent (e.g., border-l-4 border-blue-500)
       - Option B: Subtle background tint (e.g., bg-blue-50)
       - Choose whichever looks cleaner with existing styles

    2. **Unclaimed items:**
       - If no claims exist for an item, show it differently:
       - Reduced opacity (opacity-60) or faded text (text-gray-400)
       - Small indicator like "unclaimed" text or icon

    3. **Claimer display:**
       - Show claimers as comma-separated names or pills
       - Highlight current user's name (bold or different color)

    Keep tap-to-claim working. The visual changes are additive.
  </action>
  <verify>npm run build passes, visual styles apply correctly</verify>
  <done>My claimed items visually distinct, unclaimed items have indicator</done>
</task>

<task type="auto">
  <name>Task 2: Add host unclaim capability</name>
  <files>convex/claims.ts, src/components/ClaimableItem.tsx</files>
  <action>
    1. In convex/claims.ts, create a new mutation `unclaimByHost`:
       ```typescript
       export const unclaimByHost = mutation({
         args: {
           itemId: v.id("items"),
           participantId: v.id("participants"),
           hostParticipantId: v.id("participants"),
         },
         handler: async (ctx, args) => {
           // Verify hostParticipantId is actually a host
           const host = await ctx.db.get(args.hostParticipantId);
           if (!host || !host.isHost) {
             throw new Error("Only host can unclaim for others");
           }

           // Find and delete the claim
           const claim = await ctx.db
             .query("claims")
             .withIndex("by_item", (q) => q.eq("itemId", args.itemId))
             .filter((q) => q.eq(q.field("participantId"), args.participantId))
             .first();

           if (claim) {
             await ctx.db.delete(claim._id);
           }
         },
       });
       ```

    2. In ClaimableItem.tsx, when isHost is true, show a small "x" button next to each claimer name (except for anonymous display scenarios). Clicking it calls unclaimByHost.

    3. Regular users can still only unclaim themselves by tapping the item. The x buttons are host-only.
  </action>
  <verify>npm run build passes, host sees x buttons, non-host doesn't</verify>
  <done>Host can remove any participant's claim via x button</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Items I've claimed have visual distinction (border or background)
- [ ] Unclaimed items look faded or have indicator
- [ ] Host sees x buttons next to claimer names
- [ ] Host can remove anyone's claim
- [ ] Non-host users don't see x buttons for others
</verification>

<success_criteria>

- All tasks completed
- Visual hierarchy: my claims > others' claims > unclaimed
- Host has elevated control over claims
- All real-time sync still works
</success_criteria>

<output>
After completion, create `.planning/phases/05-item-management/05-02-SUMMARY.md`
</output>
