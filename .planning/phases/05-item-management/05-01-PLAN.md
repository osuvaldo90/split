---
phase: 05-item-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/pages/Session.tsx, src/components/ClaimableItem.tsx, src/pages/Join.tsx]
autonomous: true
---

<objective>
Enable tap-to-claim item interaction with real-time claimer display.

Purpose: Let participants claim items by tapping, showing who claimed what in real-time.
Output: ClaimableItem component with tap interaction and claimer names displayed.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-item-management/05-CONTEXT.md

@convex/claims.ts
@convex/items.ts
@src/pages/Session.tsx
@src/components/InlineItem.tsx
@src/lib/sessionStorage.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Track current participant in Session page</name>
  <files>src/pages/Session.tsx, src/pages/Join.tsx</files>
  <action>
    1. In Join.tsx: After successful join (both new join and auto-restore), store the participantId in sessionStorage using the existing storeParticipant function. The stored data should include sessionCode so we can match it.

    2. In Session.tsx: Add a hook to retrieve the current participantId from sessionStorage using getStoredParticipant. Compare the stored sessionCode with the current session code to ensure we have the right participant.

    3. Fetch the current participant's data using a useQuery to get their isHost status and name.

    The key insight: sessionStorage.ts already has getStoredParticipant/storeParticipant. We need to ensure Join.tsx stores the sessionCode along with participantId, then Session.tsx can retrieve and verify it matches.

    Check if sessionStorage.ts already stores sessionCode - if not, update the type and storeParticipant call to include it.
  </action>
  <verify>Console log currentParticipant in Session.tsx - should show name and isHost status</verify>
  <done>Session page knows who the current user is (participantId, name, isHost)</done>
</task>

<task type="auto">
  <name>Task 2: Create ClaimableItem component with tap interaction</name>
  <files>src/components/ClaimableItem.tsx</files>
  <action>
    Create new ClaimableItem component that:

    1. Props: item (with _id, name, price, quantity), claims (array of claims for this item), participants (array for name lookup), currentParticipantId (Id or null), isHost (boolean)

    2. Display:
       - Item name and price (similar to InlineItem view mode)
       - Below the item: list of claimer names (look up participant names from claims.participantId)
       - If no claimers: show nothing or subtle "unclaimed" indicator

    3. Tap interaction:
       - If current user hasn't claimed: call claims.claim mutation
       - If current user has claimed: call claims.unclaim mutation
       - Make the whole item row tappable (not just a button)

    4. Keep the edit button from InlineItem - tapping the pencil icon should NOT trigger claim. Use event.stopPropagation() on the edit button.

    5. The component should still support edit mode (keep InlineItem's edit functionality or delegate to it).

    Use useMutation for claims.claim and claims.unclaim. Both mutations already exist and are idempotent.
  </action>
  <verify>npm run build passes, component renders without errors</verify>
  <done>ClaimableItem shows item with claimers, tap toggles own claim</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ClaimableItem in Session page</name>
  <files>src/pages/Session.tsx</files>
  <action>
    1. Add useQuery for claims.listBySession to fetch all claims for the session

    2. Replace InlineItem with ClaimableItem in the items list:
       - Pass item, claims (filtered by itemId), participants, currentParticipantId, isHost
       - Filter claims for each item: claims.filter(c => c.itemId === item._id)

    3. If currentParticipantId is null (user not joined), ClaimableItem should show items but disable claim interaction (show "Join to claim items" or similar).

    4. Keep the "Add Item" button as-is (it still works for adding new items).
  </action>
  <verify>npm run dev - items show claimers, tapping toggles claims in real-time</verify>
  <done>Session page uses ClaimableItem with full claim/unclaim functionality</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Session page shows current participant info
- [ ] Items display claimer names below each item
- [ ] Tapping item toggles own claim (add if not claimed, remove if claimed)
- [ ] Multiple people can claim same item (names accumulate)
- [ ] Real-time sync: claiming on one device shows on all devices
</verification>

<success_criteria>

- All tasks completed
- Tap-to-claim works with real-time updates
- Claimer names visible under each item
- Edit button still works (doesn't trigger claim)
</success_criteria>

<output>
After completion, create `.planning/phases/05-item-management/05-01-SUMMARY.md`
</output>
