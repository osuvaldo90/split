# v1.2 Test Foundation Roadmap

**Milestone Goal:** Comprehensive test coverage to prevent regressions in authorization, calculations, and real-time sync.

## Phases

- [x] **Phase 15: Test Infrastructure** - Vitest + convex-test + Playwright configured
- [x] **Phase 16: Authorization Tests** - Unit tests for all auth boundary checks
- [x] **Phase 17: Calculation Tests** - Unit tests for split/tax/tip calculations
- [x] **Phase 18: Mutation Tests** - Unit tests for core mutations and validation
- [x] **Phase 19: E2E Tests** - Browser automation for host and join flows

## Phase Details

### Phase 15: Test Infrastructure
**Goal**: Test runners configured and operational
**Depends on**: Nothing (first phase of v1.2)
**Requirements**: None (infrastructure)
**Success Criteria** (what must be TRUE):
  1. `npm test` runs Vitest successfully
  2. convex-test creates mock database for function tests
  3. Playwright launches browser and navigates to app
  4. All test scripts documented in package.json
**Research**: Unlikely (well-documented convex-test setup)
**Plans**: TBD

### Phase 16: Authorization Tests
**Goal**: Authorization logic fully tested with 100% coverage on auth checks
**Depends on**: Phase 15
**Requirements**: BTEST-01, BTEST-02, BTEST-03, BTEST-04, BTEST-05, BTEST-06, BTEST-07, BTEST-08, BTEST-09
**Success Criteria** (what must be TRUE):
  1. Tests verify non-participants cannot add/claim items
  2. Tests verify non-hosts cannot change tip/tax settings or remove items
  3. Tests verify cross-session access is blocked
  4. Tests verify authorized users can perform their allowed actions
**Research**: Unlikely (standard convex-test patterns)
**Plans**: TBD

### Phase 17: Calculation Tests
**Goal**: Financial calculation logic fully tested with 100% coverage
**Depends on**: Phase 15
**Requirements**: BTEST-10, BTEST-11, BTEST-12, BTEST-13, BTEST-14, BTEST-15
**Success Criteria** (what must be TRUE):
  1. Tests verify even split distribution with remainder handling
  2. Tests verify tax distribution proportional to subtotal share
  3. Tests verify all tip calculation modes (percent on subtotal, percent on total, manual)
  4. Tests verify edge cases (zero claimants, single claimant)
**Research**: Unlikely (standard unit test patterns)
**Plans**: TBD

### Phase 18: Mutation Tests
**Goal**: Core mutations and input validation tested
**Depends on**: Phase 15
**Requirements**: BTEST-16, BTEST-17, BTEST-18, BTEST-19, BTEST-20, BTEST-21, BTEST-22, BTEST-23
**Success Criteria** (what must be TRUE):
  1. Tests verify session creation generates valid 6-char codes
  2. Tests verify joining creates participant correctly and rejects duplicates
  3. Tests verify claim idempotency and removal cascades
  4. Tests verify input validation catches invalid names, money values, tip percents
**Research**: Unlikely (standard convex-test patterns)
**Plans**: TBD

### Phase 19: E2E Tests
**Goal**: Browser automation validates complete user flows
**Depends on**: Phases 16-18 (backend tests should pass first)
**Requirements**: E2E-01, E2E-02, E2E-03, E2E-04, E2E-05, E2E-06, E2E-07, E2E-08
**Success Criteria** (what must be TRUE):
  1. Host can complete full flow (create bill → add items → set tip → view summary)
  2. Guest can complete full flow (join via code → enter name → claim items → see totals)
  3. Tests pass reliably without flakiness (no waitForTimeout)
  4. Tests properly isolated via browser contexts
**Research**: Likely (multi-context fixture patterns, WebSocket wait strategies)
**Research topics**: Playwright multi-context fixtures, Convex WebSocket interception patterns
**Plans**: TBD

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 15. Test Infrastructure | 1/1 | Complete | 2026-01-15 |
| 16. Authorization Tests | 1/1 | Complete | 2026-01-15 |
| 17. Calculation Tests | 1/1 | Complete | 2026-01-15 |
| 18. Mutation Tests | 1/1 | Complete | 2026-01-15 |
| 19. E2E Tests | 2/2 | Complete | 2026-01-15 |

---
*Created: 2026-01-15*
