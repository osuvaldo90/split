# Milestone v1.1: Access Control

**Status:** SHIPPED 2026-01-15
**Phases:** 14
**Total Plans:** 4

## Overview

Secure bill sessions so only joined participants can view and mutate, with verified host-only restrictions for tax/tip.

## Phases

### Phase 14: Access Control

**Goal**: Secure bill sessions with proper authorization
**Depends on**: Phase 13 (builds on security hardening)
**Requirements**: ACCESS-01, ACCESS-02, ACCESS-03
**Success Criteria** (what must be TRUE):
  1. User cannot view bill content at `/bill/:id` without first joining the session
  2. All item/claim mutations fail for non-participants
  3. Tax and tip mutations fail for non-hosts
  4. Existing participants retain full functionality
**Plans**: 4

Plans:
- [x] 14-01: Route protection with JoinGate component
- [x] 14-02: Mutation authorization (participantId verification)
- [x] 14-03: Frontend mutation call updates
- [x] 14-04: Host-only authorization audit

**Details:**
- Created JoinGate component with name input, join button, loading/error states
- Modified Session.tsx to show JoinGate when user isn't a participant
- Added participantId verification to items.add, items.update, claims.claim, sessions.updateTotals
- All host-only mutations verified: updateTip, updateTax, updateGratuity, items.remove, items.addBulk, claims.unclaimByHost
- Fixed cross-session vulnerability in unclaimByHost

---

## Milestone Summary

**Key Decisions:**
- Route-level gating based on participant status (JoinGate component)
- Immediate state update after join (justJoinedParticipantId) - no page refresh needed
- Host-only mutation pattern: fetch participant, check isHost, verify sessionId
- All participant checks happen early, before any writes

**Issues Resolved:**
- Fixed missing participantId in frontend mutation calls (auto-fixed during 14-01)
- Fixed cross-session vulnerability in unclaimByHost (host could unclaim in other sessions)

**Issues Deferred:**
None - all v1.1 requirements satisfied.

**Technical Debt Incurred:**
- receipts.saveReceiptImage lacks participantId verification (frontend-gated only) [P3]
- Query endpoints don't verify participant at API level (UI-level protection satisfies stated requirement) [P3]
- claims.unclaim missing cross-session check for host case [P3]

---

_For current project status, see .planning/PROJECT.md_
_Archived: 2026-01-15 as part of v1.1 milestone completion_
